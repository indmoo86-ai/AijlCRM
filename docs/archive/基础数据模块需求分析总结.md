# 艾居来 CRM - 基础数据模块需求分析总结报告

**项目名称**：艾居来 CRM
**文档版本**：v1.0
**完成日期**：2025-12-22
**编写人**：Requirements Analysis Officer

---

## 一、项目概览

### 1.1 项目基本信息
- **项目名称**：艾居来 CRM
- **行业领域**：酒店智能硬件营销
- **部署方式**：阿里云部署
- **用户规模**：10人以内

### 1.2 核心业务目标
1. **标准化流程，避免疏漏**：建立标准化的业务流程节点和检查点
2. **系统待办事项随时提醒**：自动生成基于流程节点的待办任务
3. **全流程数据串通**：打通销售线索 → 跟踪 → 合同 → 服务 → 财务 → 发票的完整业务链

### 1.3 团队角色
- **新媒体营销**：负责收集销售线索
- **销售**：负责跟踪线索，促成销售，签署合同
- **财务**：负责发票和收款
- **产品运营**：负责发货和售后服务

---

## 二、需求分析成果总结

### 2.1 模块清单

本次需求分析完成了**基础数据模块**的三个子模块：

| 模块名称 | 数据表数量 | 功能需求（User Stories） | 优先级P0需求数 |
|---------|----------|------------------------|--------------|
| **产品管理** | 2张表 | 6个（PRD-001 至 PRD-006） | 4个 |
| **客户管理** | 4张表 | 8个（CRM-001 至 CRM-008） | 5个 |
| **用户角色权限管理** | 6张表 | 8个（AUTH-001 至 AUTH-008） | 6个 |
| **合计** | **12张表** | **22个User Stories** | **15个P0需求** |

---

### 2.2 数据模型汇总

#### 2.2.1 产品管理模块（2张表）
1. **产品分类表（product_category）**：管理5-6个产品大类
2. **产品SKU表（product）**：管理200-300个产品SKU
   - 包含：产品编码、名称、分类、图片、供应商、成本价、报价、单位、备注
   - 预留6个自定义扩展字段 + 权限控制字段

**核心特性**：
- 扁平化SKU管理（不同规格视为不同SKU）
- 产品状态管理（草稿/在售/停售）
- 历史快照保护（产品信息修改不影响历史合同）
- 批量导入导出

---

#### 2.2.2 客户管理模块（4张表）
1. **客户表（customer）**：管理客户全生命周期信息
   - 客户类型：连锁酒店集团、单体酒店、经销商
   - 客户等级：A/B/C类
   - 客户阶段：销售线索 → 初步接触 → 意向客户 → 商务洽谈 → 成交客户 → 流失客户
   - 预留5个自定义扩展字段 + 权限控制字段

2. **客户联系人表（customer_contact）**：一个客户多个联系人
   - 支持主要联系人标识
   - 记录姓名、职位、手机、微信、邮箱

3. **客户跟进记录表（customer_follow_up）**：记录每次跟进
   - 跟进方式：电话/微信/上门拜访/邮件
   - 自动生成待办任务提醒（根据"下次跟进计划"）
   - 不允许删除，仅可作废

4. **客户来源渠道表（customer_source）**（可选）：配置客户来源
   - 新媒体营销、线下展会、老客户转介绍、官网咨询、电话来访等

**核心特性**：
- 全生命周期阶段管理
- 多联系人管理
- 跟进记录自动生成待办
- 负责人转移
- 全流程关联查看（报价单、合同、发票、收款记录）

---

#### 2.2.3 用户角色权限管理模块（6张表）
1. **用户表（user）**：管理系统用户账户
   - 登录方式：手机号 + 密码
   - 密码强度要求：至少8位，包含大小写字母和数字
   - 首次登录强制修改密码
   - 连续登录失败5次锁定30分钟

2. **角色表（role）**：固定5个角色
   - 系统管理员
   - 营销人员
   - 销售人员
   - 财务人员
   - 运营人员

3. **用户角色关联表（user_role）**：一个用户可拥有多个角色

4. **权限表（permission）**：模块级权限
   - 产品管理、客户管理、用户管理
   - 报价单管理、合同管理、发货管理、发票管理、收款管理、售后服务（后续扩展）

5. **角色权限关联表（role_permission）**：为角色配置权限

6. **操作审计日志表（audit_log）**：记录所有关键操作
   - 记录：操作人、操作模块、操作类型、操作描述、IP地址、请求参数
   - 敏感信息脱敏
   - 不允许删除，仅可查询
   - 保留期限至少1年

**核心特性**：
- 简化RBAC（固定5个角色 + 模块级权限）
- 手机号+密码登录
- JWT Token管理（有效期7天，自动刷新）
- 操作审计日志（全面可追溯）
- 不需要部门管理

---

## 三、关键业务规则

### 3.1 产品管理
1. 产品编码全局唯一，建议格式：分类编码-流水号（如：CHECKIN-A100）
2. 产品被合同/报价单引用后，不允许删除，仅可标记为停售或软删除
3. 产品信息修改不影响历史合同（使用快照数据）
4. 成本价和报价不能为负数

### 3.2 客户管理
1. 客户编码自动生成，格式：CUST-YYYYMMDD-流水号
2. 客户阶段原则上只能向前推进，不允许回退
3. 每个客户至少有一个主要联系人
4. 跟进记录不允许删除，仅可标记为"已作废"
5. 设置"下次跟进计划"时，系统自动生成待办任务提醒

### 3.3 用户权限管理
1. 手机号全局唯一
2. 密码使用bcrypt哈希，不存储明文
3. 首次登录强制修改初始密码
4. 连续登录失败5次后，账户锁定30分钟
5. 系统至少保留1个启用状态的系统管理员账户
6. 操作日志不允许删除，敏感信息需脱敏

---

## 四、技术架构建议

### 4.1 数据库设计
- **数据库类型**：MySQL 8.0+ 或 PostgreSQL 13+
- **字符集**：UTF8MB4（支持表情符号）
- **总表数量**：12张核心表
- **索引策略**：
  - 主键：所有表使用BIGINT自增主键
  - 唯一索引：编码字段、手机号等唯一字段
  - 普通索引：外键字段、状态字段、时间字段

### 4.2 权限控制
- **权限模型**：RBAC（基于角色的访问控制）
- **权限粒度**：模块级（不细化到按钮级）
- **数据权限**：v1.0阶段不启用数据隔离，预留字段支持未来扩展
- **Token方案**：JWT，有效期7天，自动刷新

### 4.3 审计日志
- **记录范围**：所有新增、修改、删除操作
- **敏感信息**：密码、手机号等字段脱敏
- **存储策略**：至少保留1年，超期归档到冷存储
- **查询性能**：按时间、用户、模块、操作类型建立索引

---

## 五、待办事项与下一步计划

### 5.1 基础数据模块已完成 ✅
- [x] 产品管理模块需求分析
- [x] 客户管理模块需求分析
- [x] 用户角色权限管理模块需求分析
- [x] 数据模型设计（12张表）
- [x] 功能需求定义（22个User Stories，所有需求均有Gherkin验收标准）

### 5.2 后续模块需求分析（建议优先级）

**高优先级（P0）** - 核心业务流程：
1. **销售线索管理模块**
   - 线索录入、分配、转化
   - 线索池管理

2. **报价单管理模块**
   - 报价单创建、产品选择、价格计算
   - 报价单版本管理
   - 报价单转合同

3. **合同管理模块**
   - 合同创建、审核、签订
   - 合同执行跟踪
   - 合同变更管理

4. **待办任务与提醒系统**（支撑模块）
   - 任务自动生成规则
   - 任务分配与提醒
   - 逾期预警

**中优先级（P1）** - 业务支撑流程：
5. **发货管理模块**
   - 发货单管理
   - 物流信息跟踪

6. **发票管理模块**
   - 发票开具
   - 发票记录管理

7. **收款管理模块**
   - 收款记录
   - 应收账款管理

8. **售后服务模块**
   - 售后工单管理
   - 服务记录跟踪

**低优先级（P2）** - 分析与报表：
9. **数据统计与报表**
   - 销售漏斗分析
   - 业绩报表
   - 客户分析报表

### 5.3 技术方案设计阶段

如果您确认基础数据模块需求无误，建议进入技术方案设计阶段：

1. **系统架构设计**
   - 前端技术栈选型（React/Vue）
   - 后端技术栈选型（Spring Boot/Node.js）
   - 部署架构设计（阿里云方案）

2. **数据库详细设计**
   - 完整DDL脚本生成
   - 初始化数据脚本
   - 数据迁移方案

3. **接口设计**
   - RESTful API设计
   - 接口文档（Swagger/OpenAPI）

4. **UI/UX设计**
   - 原型设计
   - 交互流程设计

5. **开发计划**
   - 开发任务拆解
   - 开发排期
   - 测试计划

---

## 六、关键决策记录

### 6.1 产品管理
- ✅ **决策1**：采用扁平化SKU管理，不同规格视为不同SKU
- ✅ **决策2**：不需要库存管理
- ✅ **决策3**：仅成本价+报价两种价格，无需多价格体系
- ✅ **决策4**：预留6个自定义扩展字段

### 6.2 客户管理
- ✅ **决策5**：采用统一客户表+客户阶段字段方案（不分离线索表和客户表）
- ✅ **决策6**：客户类型3种，客户等级3级，客户阶段6个
- ✅ **决策7**：一个客户可以有多个联系人，至少一个主要联系人
- ✅ **决策8**：跟进记录自动生成待办任务提醒

### 6.3 用户权限管理
- ✅ **决策9**：固定5个角色，不支持自定义角色创建
- ✅ **决策10**：模块级权限，不细化到按钮级
- ✅ **决策11**：一个用户可以拥有多个角色
- ✅ **决策12**：登录方式：手机号 + 密码
- ✅ **决策13**：不需要部门管理
- ✅ **决策14**：需要操作审计日志

### 6.4 权限设计
- ✅ **决策15**：v1.0阶段不启用数据隔离，所有角色可见全部数据
- ✅ **决策16**：预留creator_id、owner_id、department_id、data_permission_level字段支持未来扩展
- ✅ **决策17**：无审批流程

---

## 七、文档交付清单

### 7.1 主文档
- ✅ **requirements.md**：完整的软件需求规格说明书（SRS）
  - 包含：业务目标、KPI、用户角色、数据模型、功能需求（22个User Stories）

### 7.2 辅助文档
- ✅ **oql.md**：开放问题清单（6个问题已解决，4个问题待后续模块确认）
- ✅ **基础数据模块需求分析总结.md**：本总结报告

### 7.3 数据模型
- ✅ 12张数据表的详细设计（字段、类型、约束、索引、业务规则）
- ✅ 表关系图（文字描述，可后续绘制ER图）

### 7.4 功能需求
- ✅ 22个User Stories，每个都包含：
  - User Story描述
  - Gherkin格式的验收标准（Given-When-Then）
  - 优先级标识
  - 依赖关系
  - 关联模块

---

## 八、风险与建议

### 8.1 风险识别
1. **数据量增长风险**：客户、产品、日志数据量可能快速增长
   - **建议**：定期归档历史数据，优化索引

2. **权限扩展风险**：未来可能需要数据权限隔离
   - **建议**：已预留字段，架构支持扩展

3. **第三方集成风险**：未来可能需要与ERP、财务系统集成
   - **建议**：在后续模块设计时预留集成接口

### 8.2 质量建议
1. **测试覆盖**：所有P0需求（15个）必须有完整的测试用例
2. **代码审查**：关键业务逻辑（权限、审计日志、数据快照）需要严格代码审查
3. **性能测试**：日志表、客户表需进行压力测试（模拟100万+数据量）

---

## 九、联系与反馈

如有任何疑问或需要进一步澄清，请联系：
- **需求分析负责人**：Requirements Analysis Officer
- **文档位置**：`/Users/robin/claude code/requirements.md`

---

**文档结束**

生成时间：2025-12-22
文档版本：v1.0
