# 艾居来CRM 前端UI联调指南

**测试日期**: 2025-12-27
**前端服务**: http://localhost:5173
**后端服务**: http://localhost:3000
**测试环境**: Development (SQLite)

---

## 🎯 测试目标

验证前端UI与后端API的完整集成，确保所有业务功能在前端界面上可正常操作。

---

## 📋 前置条件检查

### 1. 服务状态确认

```bash
# 检查后端服务
curl http://localhost:3000/health

# 检查前端服务
curl http://localhost:5173

# 查看后端日志
cd /Users/robin/claude\ code/AijlCRM/backend && npm run dev

# 查看前端日志
cd /Users/robin/claude\ code/AijlCRM/frontend && npm run dev
```

### 2. 测试数据准备

```bash
# 创建管理员账户 (如果还没有)
cd /Users/robin/claude\ code/AijlCRM/backend
node scripts/create-admin-user.js
```

**测试账户**:
- 用户名: `admin`
- 密码: `123456`

---

## 🧪 完整业务流程UI测试

### 测试流程 1: 用户登录 ✅

**测试步骤**:
1. 打开浏览器访问: http://localhost:5173
2. 应该看到登录页面
3. 输入用户名: `admin`
4. 输入密码: `123456`
5. 点击"登录"按钮

**预期结果**:
- ✅ 登录成功，跳转到Dashboard页面
- ✅ 顶部显示用户名 "系统管理员"
- ✅ 左侧菜单显示所有功能模块

**验证点**:
- [ ] 登录表单显示正常
- [ ] 用户名和密码输入框可输入
- [ ] 登录按钮可点击
- [ ] 登录成功后跳转
- [ ] 错误密码显示错误提示

**对应API**: `POST /api/auth/login`

---

### 测试流程 2: Dashboard仪表板 ✅

**测试步骤**:
1. 登录后查看Dashboard页面
2. 检查各个统计卡片

**预期结果**:
- ✅ 显示业务统计数据
- ✅ 显示图表可视化
- ✅ 显示待办任务列表

**验证点**:
- [ ] 统计卡片数据显示正确
- [ ] 图表渲染正常
- [ ] 最近动态显示

**对应API**: `GET /api/dashboard/statistics`

---

### 测试流程 3: 产品管理 ✅

#### 3.1 产品分类管理

**测试步骤**:
1. 点击左侧菜单"产品管理" → "产品分类"
2. 点击"新增分类"按钮
3. 填写表单:
   - 分类名称: `智能门锁`
   - 分类代码: `smart-lock`
   - 描述: `智能门锁系列产品`
4. 点击"确定"保存

**预期结果**:
- ✅ 分类列表页面正常显示
- ✅ 新增分类成功提示
- ✅ 分类列表中显示新增的分类

**验证点**:
- [ ] 分类列表加载正常
- [ ] 新增按钮可点击
- [ ] 表单字段显示正确
- [ ] 保存成功提示
- [ ] 列表自动刷新

**对应API**:
- `GET /api/products/categories` (列表)
- `POST /api/products/categories` (创建)

#### 3.2 产品管理

**测试步骤**:
1. 点击左侧菜单"产品管理" → "产品列表"
2. 点击"新增产品"按钮
3. 填写表单:
   - 产品代码: `LOCK-001`
   - 产品名称: `智能门锁 Pro`
   - 品牌: `艾居来`
   - 产品分类: 选择"智能门锁"
   - 成本价: `500`
   - 销售价: `800`
   - 单位: `台`
   - 描述: `高端智能门锁，支持指纹识别和密码开锁`
4. 点击"确定"保存

**预期结果**:
- ✅ 产品列表页面正常显示
- ✅ 新增产品成功提示
- ✅ 产品列表中显示新增的产品

**验证点**:
- [ ] 产品列表加载正常
- [ ] 搜索和筛选功能正常
- [ ] 分页功能正常
- [ ] 新增表单字段完整
- [ ] 分类下拉框正常
- [ ] 价格输入验证正确

**对应API**:
- `GET /api/products` (列表)
- `POST /api/products` (创建)
- `GET /api/products/:id` (详情)

---

### 测试流程 4: 线索管理 ✅

#### 4.1 创建线索

**测试步骤**:
1. 点击左侧菜单"线索管理"
2. 点击"新增线索"按钮
3. 填写表单:
   - 客户名称: `张经理`
   - 酒店名称: `测试酒店-UI联调-001`
   - 手机号: `13800138001`
   - 省份: `广东省`
   - 城市: `深圳市`
   - 渠道来源: `网络推广`
   - 销售负责人: 选择"系统管理员"
4. 点击"确定"保存

**预期结果**:
- ✅ 线索创建成功
- ✅ 自动生成线索编号
- ✅ 线索列表中显示新线索

**验证点**:
- [ ] 线索列表加载正常
- [ ] 新增表单字段完整
- [ ] 必填字段验证
- [ ] 省市选择器正常
- [ ] 销售负责人下拉框正常
- [ ] 保存成功提示

**对应API**:
- `GET /api/leads` (列表)
- `POST /api/leads` (创建)

#### 4.2 添加跟进记录

**测试步骤**:
1. 在线索列表中点击刚创建的线索
2. 进入线索详情页
3. 点击"添加跟进"按钮
4. 填写跟进记录:
   - 跟进方式: `电话沟通`
   - 跟进内容: `初次电话沟通，客户有采购意向`
   - 下次跟进时间: 选择明天的日期
5. 点击"保存"

**预期结果**:
- ✅ 跟进记录添加成功
- ✅ 线索状态更新为"跟进中"
- ✅ 跟进记录列表显示新记录

**验证点**:
- [ ] 线索详情页显示完整
- [ ] 跟进记录列表加载
- [ ] 添加跟进表单正常
- [ ] 日期选择器正常
- [ ] 跟进记录保存成功

**对应API**:
- `POST /api/leads/:id/follow-up` (添加跟进)
- `GET /api/leads/:id/follow-up` (跟进列表)

#### 4.3 线索转客户

**测试步骤**:
1. 在线索详情页
2. 点击"转客户"按钮
3. 确认转化

**预期结果**:
- ✅ 线索转客户成功
- ✅ 自动生成客户编号
- ✅ 跳转到客户详情页
- ✅ 线索状态更新为"已转化"

**验证点**:
- [ ] 转客户按钮可点击
- [ ] 确认对话框显示
- [ ] 转化成功提示
- [ ] 自动跳转客户详情

**对应API**: `POST /api/leads/:id/convert`

---

### 测试流程 5: 客户管理 ✅

**测试步骤**:
1. 点击左侧菜单"客户管理"
2. 查看客户列表
3. 点击刚转化的客户进入详情页
4. 查看客户基本信息
5. 查看关联的线索信息

**预期结果**:
- ✅ 客户列表正常显示
- ✅ 客户详情信息完整
- ✅ 显示来源线索信息
- ✅ 可以添加联系人

**验证点**:
- [ ] 客户列表加载正常
- [ ] 搜索筛选功能
- [ ] 客户详情完整
- [ ] 联系人管理功能
- [ ] 跟进记录显示

**对应API**:
- `GET /api/customers` (列表)
- `GET /api/customers/:id` (详情)
- `POST /api/customers/:id/contacts` (添加联系人)

---

### 测试流程 6: 报价单管理 ✅

**测试步骤**:
1. 点击左侧菜单"报价管理"
2. 点击"新增报价单"按钮
3. 填写报价单信息:
   - 客户: 选择刚创建的客户
   - 报价单标题: `测试酒店智能锁采购报价单`
   - 有效期: `30天`
4. 添加产品明细:
   - 产品: 选择"智能门锁 Pro"
   - 数量: `100`
   - 单价: `800`
   - 折扣率: `0.95`
5. 点击"保存"

**预期结果**:
- ✅ 报价单创建成功
- ✅ 自动计算总金额
- ✅ 自动生成报价单编号

**验证点**:
- [ ] 报价单列表加载
- [ ] 客户选择器正常
- [ ] 产品明细可添加删除
- [ ] 产品选择器正常
- [ ] 金额自动计算
- [ ] 保存成功提示

**对应API**:
- `GET /api/quotations` (列表)
- `POST /api/quotations` (创建)
- `GET /api/quotations/:id` (详情)

---

### 测试流程 7: 合同管理 ✅

**测试步骤**:
1. 点击左侧菜单"合同管理"
2. 点击"新增合同"按钮
3. 填写合同信息:
   - 客户: 选择客户
   - 合同标题: `测试酒店智能锁采购合同`
   - 合同类型: `产品销售`
   - 签订日期: 选择今天
   - 生效日期: 选择今天
   - 到期日期: 选择未来日期
   - 合同总金额: `80000`
4. 添加合同产品明细 (从报价单导入或手动添加)
5. 点击"保存"

**预期结果**:
- ✅ 合同创建成功
- ✅ 自动生成合同编号
- ✅ 合同详情显示完整

**验证点**:
- [ ] 合同列表加载
- [ ] 新增表单完整
- [ ] 日期选择器正常
- [ ] 从报价单导入功能
- [ ] 合同明细管理
- [ ] 金额计算正确

**对应API**:
- `GET /api/contracts` (列表)
- `POST /api/contracts` (创建)
- `GET /api/contracts/:id` (详情)

---

### 测试流程 8: 发货管理 ✅

**测试步骤**:
1. 点击左侧菜单"发货管理"
2. 点击"新增发货单"按钮
3. 填写发货单信息:
   - 合同: 选择刚创建的合同
   - 发货单标题: `测试酒店智能锁发货单`
   - 收货地址: `广东省深圳市南山区科技园`
   - 联系人: `张经理`
   - 联系电话: `13800138001`
   - 计划发货日期: 选择今天
4. 添加发货明细:
   - 产品: `智能门锁 Pro`
   - 本次发货数量: `50`
5. 点击"保存"
6. 在发货单列表中点击"确认发货"
7. 填写物流信息:
   - 物流公司: `顺丰速运`
   - 运单号: `SF123456789`
   - 实际发货日期: 选择今天
8. 确认发货

**预期结果**:
- ✅ 发货单创建成功
- ✅ 发货金额自动计算
- ✅ 确认发货后状态更新
- ✅ 合同的shipped_amount自动更新

**验证点**:
- [ ] 发货单列表加载
- [ ] 合同选择器正常
- [ ] 发货明细管理
- [ ] 数量验证（不超过合同数量）
- [ ] 金额自动计算
- [ ] 确认发货功能
- [ ] 物流信息填写
- [ ] 状态变更正常

**对应API**:
- `GET /api/shipments` (列表)
- `POST /api/shipments` (创建)
- `PUT /api/shipments/:id/confirm` (确认发货)
- `GET /api/contracts/:id` (查看合同shipped_amount更新)

---

### 测试流程 9: 收款管理 ✅

**测试步骤**:
1. 点击左侧菜单"收款管理"
2. 点击"新增收款记录"按钮
3. 填写收款信息:
   - 合同: 选择合同
   - 收款阶段: `预付款`
   - 收款金额: `40000`
   - 收款日期: 选择今天
   - 收款方式: `银行转账`
   - 银行账号: `6228480402564890018`
   - 交易流水号: `TX202512270001`
   - 付款方: `测试酒店-UI联调-001`
4. 点击"保存"
5. 在收款记录列表中点击"确认收款"
6. 填写确认备注
7. 确认

**预期结果**:
- ✅ 收款记录创建成功
- ✅ 确认收款后状态更新
- ✅ 合同的received_amount自动更新

**验证点**:
- [ ] 收款记录列表加载
- [ ] 合同选择器正常
- [ ] 金额输入验证
- [ ] 收款方式选择
- [ ] 确认收款功能
- [ ] 状态变更正常
- [ ] 合同金额更新

**对应API**:
- `GET /api/payments` (列表)
- `POST /api/payments` (创建)
- `PUT /api/payments/:id/confirm` (确认收款)
- `GET /api/contracts/:id` (查看received_amount更新)

---

### 测试流程 10: 发票管理 ✅

**测试步骤**:
1. 点击左侧菜单"发票管理"
2. 点击"新增发票"按钮
3. 填写发票信息:
   - 合同: 选择合同
   - 收款记录: 选择刚创建的收款记录
   - 发票类型: `增值税专用发票`
   - 开票金额: `40000`
   - 开票日期: 选择今天
   - 发票抬头: `测试酒店-UI联调-001`
   - 税号: `91440300MA5DXXXX`
   - 公司地址: `广东省深圳市南山区科技园`
   - 公司电话: `0755-12345678`
   - 开户行: `中国工商银行深圳支行`
   - 银行账号: `4000021234567890`
4. 点击"保存"
5. 在发票列表中点击"确认开票"
6. 填写发票号码和开票日期
7. 确认

**预期结果**:
- ✅ 发票创建成功
- ✅ 确认开票后状态更新
- ✅ 合同的invoiced_amount自动更新

**验证点**:
- [ ] 发票列表加载
- [ ] 合同和收款记录关联
- [ ] 发票类型选择
- [ ] 税务信息填写完整
- [ ] 确认开票功能
- [ ] 发票号码填写
- [ ] 状态变更正常
- [ ] 合同金额更新

**对应API**:
- `GET /api/invoices` (列表)
- `POST /api/invoices` (创建)
- `PUT /api/invoices/:id/confirm` (确认开票)
- `GET /api/contracts/:id` (查看invoiced_amount更新)

---

### 测试流程 11: 售后服务 ✅

**测试步骤**:
1. 点击左侧菜单"售后服务"
2. 点击"新建工单"按钮
3. 填写工单信息:
   - 客户: 选择客户
   - 合同: 选择合同
   - 产品: 选择产品
   - 工单类型: `安装调试`
   - 工单标题: `智能门锁安装服务`
   - 优先级: `中`
   - 问题描述: `需要安装50台智能门锁`
   - 期望解决日期: 选择未来日期
4. 点击"保存"
5. 在工单列表中点击工单进入详情
6. 点击"分配工单"，选择处理人
7. 添加操作日志
8. 点击"解决工单"
9. 填写解决方案和费用
10. 点击"关闭工单"

**预期结果**:
- ✅ 工单创建成功
- ✅ 工单状态流转正常
- ✅ 操作日志自动记录
- ✅ 服务费用统计

**验证点**:
- [ ] 工单列表加载
- [ ] 工单创建表单完整
- [ ] 工单详情显示
- [ ] 分配工单功能
- [ ] 操作日志记录
- [ ] 状态流转 (pending → in_progress → resolved → closed)
- [ ] 费用计算
- [ ] 客户评价功能

**对应API**:
- `GET /api/service-tickets` (列表)
- `POST /api/service-tickets` (创建)
- `GET /api/service-tickets/:id` (详情)
- `PUT /api/service-tickets/:id/assign` (分配)
- `POST /api/service-tickets/:id/logs` (添加日志)
- `PUT /api/service-tickets/:id/resolve` (解决)
- `PUT /api/service-tickets/:id/close` (关闭)

---

### 测试流程 12: 任务管理 ✅

**测试步骤**:
1. 点击左侧菜单"任务管理"
2. 查看任务列表
3. 查看逾期任务提醒
4. 完成任务操作
5. 延期任务操作

**预期结果**:
- ✅ 任务列表正常显示
- ✅ 按优先级和到期时间排序
- ✅ 逾期任务高亮显示
- ✅ 任务统计数据准确

**验证点**:
- [ ] 任务列表加载
- [ ] 任务筛选功能
- [ ] 完成任务功能
- [ ] 延期任务功能
- [ ] 任务统计显示
- [ ] 逾期提醒

**对应API**:
- `GET /api/tasks` (列表)
- `GET /api/tasks/overdue` (逾期任务)
- `PUT /api/tasks/:id/complete` (完成)
- `PUT /api/tasks/:id/defer` (延期)
- `GET /api/tasks/statistics` (统计)

---

## 🔍 关键UI/UX验证点

### 1. 布局和导航
- [ ] 左侧菜单可展开/收起
- [ ] 顶部导航栏显示用户信息
- [ ] 面包屑导航正确
- [ ] 页面标题显示准确

### 2. 表单验证
- [ ] 必填字段有红色星号标记
- [ ] 输入不合法时显示错误提示
- [ ] 提交前进行客户端验证
- [ ] 服务端验证错误能正确显示

### 3. 数据展示
- [ ] 列表分页功能正常
- [ ] 搜索功能响应快速
- [ ] 筛选器工作正常
- [ ] 排序功能正确

### 4. 交互反馈
- [ ] 按钮点击有loading状态
- [ ] 操作成功有成功提示
- [ ] 操作失败有错误提示
- [ ] 确认对话框显示正确

### 5. 数据关联
- [ ] 下拉选择器数据正确
- [ ] 级联选择器工作正常
- [ ] 关联数据自动填充
- [ ] 数据同步更新

---

## 🐛 常见问题排查

### 问题1: 登录后白屏
**可能原因**:
- Token未正确保存到localStorage
- API响应格式不匹配前端预期

**排查方法**:
```javascript
// 打开浏览器开发者工具 Console
console.log(localStorage.getItem('token'))
console.log(localStorage.getItem('userInfo'))
```

### 问题2: 列表数据不显示
**可能原因**:
- API返回格式与前端不一致
- 数据库中没有数据

**排查方法**:
```javascript
// 查看Network面板
// 检查API响应数据格式
// 验证后端返回的字段名是否与前端一致
```

### 问题3: 表单提交失败
**可能原因**:
- 必填字段缺失
- 数据格式不正确
- Token过期

**排查方法**:
```javascript
// 查看Network面板的Request Payload
// 查看Response中的错误信息
// 检查请求头中是否有Authorization
```

### 问题4: 字段显示undefined
**可能原因**:
- 前后端字段命名不一致 (camelCase vs snake_case)

**解决方法**:
- 检查API返回的字段名
- 确认前端是否做了字段转换

---

## 📊 测试完成检查清单

### 核心功能测试
- [ ] 用户登录/登出
- [ ] 产品分类和产品管理
- [ ] 线索创建和转化
- [ ] 客户管理
- [ ] 报价单创建
- [ ] 合同创建
- [ ] 发货单创建和确认
- [ ] 收款记录和确认
- [ ] 发票开具
- [ ] 售后工单管理
- [ ] 任务管理

### 数据一致性验证
- [ ] 合同shipped_amount自动更新
- [ ] 合同received_amount自动更新
- [ ] 合同invoiced_amount自动更新
- [ ] 线索转客户数据传递正确
- [ ] 报价单数据传递到合同

### 用户体验验证
- [ ] 页面加载速度< 2秒
- [ ] 操作响应及时
- [ ] 错误提示友好
- [ ] 界面美观统一
- [ ] 移动端适配（可选）

---

## 📝 测试报告模板

### 测试环境
- 前端版本:
- 后端版本:
- 浏览器:
- 测试时间:

### 测试结果汇总
| 功能模块 | 测试用例数 | 通过 | 失败 | 通过率 |
|---------|-----------|------|------|--------|
| 用户认证 | - | - | - | - |
| 产品管理 | - | - | - | - |
| 线索管理 | - | - | - | - |
| 客户管理 | - | - | - | - |
| 报价管理 | - | - | - | - |
| 合同管理 | - | - | - | - |
| 发货管理 | - | - | - | - |
| 收款管理 | - | - | - | - |
| 发票管理 | - | - | - | - |
| 售后服务 | - | - | - | - |
| 任务管理 | - | - | - | - |

### 发现的问题
1.
2.
3.

### 建议改进
1.
2.
3.

---

**测试人员**: ___________
**测试日期**: ___________
**审核人员**: ___________
**审核日期**: ___________
